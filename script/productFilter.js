

const productsData = {
    products: [
        {
            data_id: 1,
            title: "Điện thoại iPhone 16 Pro Max 256GB",
            price: "34.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iphone 16 promax"
        },
        {
            data_id: 2,
            title: "Điện thoại iPhone 16",
            price: "34.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iphone 16"
        },
        {
            data_id: 3,
            title: "Điện thoại iPhone 15 Pro Max 256GB",
            price: "34.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iphone 15 promax"
        },
        {
            data_id: 4,
            title: "Điện thoại iPhone 14 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iphone 14 promax"
        },
        {
            data_id: 5,
            title: "Điện thoại iPhone 13 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iphone 13 promax"
        },
        {
            data_id: 6,
            title: "Điện thoại iPhone 12 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iphone 12 promax"
        },
        {
            data_id: 7,
            title: "Điện thoại iPhone 11 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iphone 11 promax"
        },
        {
            data_id: 8,
            title: "Điện thoại iPhone X Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iphone X promax"
        },
        {
            data_id: 9,
            title: "Điện thoại iPhone 6S Plus",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iPhone 6S Plus"
        },
        {
            data_id: 10,
            title: "Điện Thoại Xiaomi 14T (12GB/256GB)",
            price: "11.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại Xiaomi 14T"
        },
        {
            data_id: 11,
            title: "Điện Thoại Xiaomi 14T Pro Max (12GB/256GB)",
            price: "13.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại Xiaomi 14T promax"
        },
        {
            data_id: 12,
            title: "Điện Thoại Xiaomi 13 Ultra",
            price: "16.490.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại Xiaomi 13 Ultra"
        },
        {
            data_id: 13,
            title: "Điện thoại iPhone 14 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "điện thoại iphone 14 promax"
        },
        {
            data_id: 14,
            title: "Điện thoại iPhone 14 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "nổi bật "
        },
        {
            data_id: 15,
            title: "Điện thoại iPhone 14 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "nổi bật 1"
        },
        {
            data_id: 16,
            title: "Điện thoại iPhone 14 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "nổi bật 2"
        },
        {
            data_id: 17,
            title: "Điện thoại iPhone 14 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "nổi bật 3"
        },
        {
            data_id: 18,
            title: "Điện thoại iPhone 14 Pro Max 256GB",
            price: "20.990.000₫",
            category: "mobile",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "nổi bật 4"
        },
        {
            data_id: 19,
            title: "Laptop Asus Vivobook E1404FA-NK186W",
            price: "12.850.000₫",
            category: "laptop",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "Laptop Asus Vivobook E1404FA-NK186W"
        },
        {
            data_id: 20,
            title: "Laptop HP 15-da0037TX/i3",
            price: "9.990.000₫",
            category: "laptop",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "Laptop HP 15-da0037TX/i3"
        },
        {
            data_id: 21,
            title: "Laptop Acer Aspire 3 A315-510P-34XZ",
            price: "10.990.000₫",
            category: "laptop",
            image: "https://res.cloudinary.com/dhjrrk4pg/image/upload/v1728974132/iphone-16-pro-max-titan-den-1-638638962017739954-750x500_drvd5f.jpg",
            dataTitle: "Laptop Acer Aspire 3 A315-510P-34XZ"
        },

    ]
};
const itemsPerPage = 12; // Số sản phẩm hiển thị trên mỗi trang
let currentPage = 1; // Trang hiện tại

const productItems = document.querySelectorAll('.product-item');

productItems.forEach(item => {
    item.addEventListener('click', function () {
        const dataFilterValue = this.getAttribute('data-filter');
        console.log("check dataFilterValue", dataFilterValue);

        // Chuyển hướng đến trang productFilter và truyền tham số
        window.location.href = `/product/productFilter.html?filter=${encodeURIComponent(dataFilterValue)}`;
    });
});

// Hàm lấy tham số từ URL
function getQueryParameter(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
}

function displayProducts() {
    const filteredProductsBox = document.querySelector('.filtered-products-box');
    const filterValue = getQueryParameter('filter')?.toLowerCase(); // Lấy giá trị filter từ URL
    const filteredProducts = productsData.products.filter(product =>
        filterValue && product.dataTitle.toLowerCase().includes(filterValue)
    );

    // Tính toán phân trang
    const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const paginatedProducts = filteredProducts.slice(startIndex, endIndex);

    filteredProductsBox.innerHTML = ''; // Xóa nội dung cũ

    let row; // Khai báo biến để chứa hàng sản phẩm

    paginatedProducts.forEach((product, index) => {
        // Tạo hàng mới nếu là sản phẩm đầu tiên trong hàng hoặc là sản phẩm thứ 4
        if (index % 4 === 0) {
            row = document.createElement('div');
            row.className = 'row'; // Thêm lớp row cho hàng
            filteredProductsBox.appendChild(row); // Thêm hàng vào container
        }

        const productItem = document.createElement('div');
        productItem.className = 'col-md-3 filtered-products-item'; // Chiều rộng của sản phẩm
        productItem.setAttribute('data-data_id', product.data_id);
        productItem.setAttribute('data-title', product.dataTitle);
        productItem.setAttribute('data-price', product.price);
        productItem.setAttribute('data-category', product.category);

        productItem.innerHTML = `
            <img class="filtered-products-item-image" src="${product.image}" />
            <h6 class="filtered-products-item-title">${product.title}</h6>
            <p class="filtered-products-item-price">${product.price}</p>
            <button class="btn-hot-products-item">Chọn sản phẩm</button>
        `;

        row.appendChild(productItem); // Thêm sản phẩm vào hàng
    });

    setupPagination(totalPages); // Thiết lập phân trang
}

function setupPagination(totalPages) {
    const paginationContainer = document.querySelector('.pagination-container');
    paginationContainer.innerHTML = ''; // Xóa nội dung cũ

    for (let i = 1; i <= totalPages; i++) {
        const pageButton = document.createElement('button');
        pageButton.innerText = i;
        pageButton.className = 'pagination-button';

        // Thêm sự kiện khi nút được nhấn
        pageButton.onclick = () => {
            currentPage = i; // Cập nhật trang hiện tại
            displayProducts(); // Hiển thị sản phẩm cho trang hiện tại
        };

        paginationContainer.appendChild(pageButton);
    }

    updateActiveButton(); // Cập nhật lớp active sau khi tạo nút
}

// Hàm để cập nhật lớp active cho nút phân trang
function updateActiveButton() {
    const buttons = document.querySelectorAll('.pagination-button'); // Chọn tất cả nút phân trang
    buttons.forEach((button, index) => {
        if (index + 1 === currentPage) {
            button.classList.add('active'); // Thêm lớp active cho nút đang chọn
        } else {
            button.classList.remove('active'); // Bỏ lớp active cho các nút khác
        }
    });
}

// Khi trang được tải, gọi hàm displayProducts để hiển thị sản phẩm
document.addEventListener('DOMContentLoaded', displayProducts);